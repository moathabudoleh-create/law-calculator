<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة الحقوق العمالية</title>

    <!-- رمز AdSense (هذا الكود كان موجودًا مسبقًا لرمز الإعلانات) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3772059497395785"
     crossorigin="anonymous"></script>
    <!-- نهاية رمز AdSense -->

    <!-- علامة الميتا المطلوبة للتحقق من ملكية الموقع لـ AdSense -->
    <meta name="google-adsense-account" content="ca-pub-3772059497395785">
    <!-- نهاية علامة الميتا -->

    <link rel="icon" type="image/x-icon" href="icon.ico.ico">
    <link rel="shortcut icon" type="image/x-icon" href="icon.ico.ico">


    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f0f4f8;
            direction: rtl;
        }
        .input-group label {
            transition: color 0.3s ease;
        }
        .input-group input[type="radio"]:checked + label {
            color: #1d4ed8;
            font-weight: bold;
        }
        /* New style for date validation error border */
        .date-error-border {
            border-color: #ef4444 !important; /* Tailwind red-500 */
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3) !important;
        }
        /* Style for the footer section to ensure it's centered */
        .footer-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        /* Custom style for the Total box */
        #total-box {
            background-color: #dbeafe; /* Tailwind blue-100 */
            border: 2px solid #3b82f6; /* Tailwind blue-500 */
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            text-align: center;
        }
        #total-box h3 {
            color: #1d4ed8; /* Tailwind blue-700 */
        }
        #total-box p {
            color: #1e40af; /* Tailwind blue-800 */
            font-size: 2.25rem; /* text-4xl equivalent */
        }
    </style>
</head>
<body class="p-4 sm:p-8 bg-gray-100 min-h-screen flex items-center justify-center">

    <div class="bg-white rounded-xl shadow-lg p-6 sm:p-10 w-full max-w-2xl border border-gray-200">
        
        <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">حاسبة الحقوق العمالية</h1>
        <p class="text-center text-gray-600 mb-8">
            بناءً على قانون العمل الأردني. أدخل معلوماتك لحساب مستحقاتك.
        </p>

        <!-- Input Section -->
        <div class="space-y-6">
            <!-- Salary Input Type Selection -->
            <div class="input-group">
                <p class="block text-sm font-medium text-gray-700 mb-2">نوع الأجر:</p>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="flex items-center">
                        <input type="radio" id="monthly" name="salaryType" value="monthly" checked class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="monthly" class="ml-2 block text-sm font-medium text-gray-700 cursor-pointer">راتب شهري</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" id="daily" name="salaryType" value="daily" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="daily" class="ml-2 block text-sm font-medium text-gray-700 cursor-pointer">أجر يومي</label>
                    </div>
                </div>
            </div>

            <!-- Salary Input Field -->
            <div>
                <label for="salaryInput" id="salaryLabel" class="block text-sm font-medium text-gray-700">الراتب الشهري الأخير (دينار)</label>
                <input type="number" id="salaryInput" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="أدخل راتبك الشهري">
            </div>

            <!-- Accrued Salaries Input Group -->
            <div>
                <label for="accruedSalariesInput" class="block text-sm font-bold text-gray-700">الرواتب المستحقة (الرواتب غير مقبوضة)</label>
                <input type="number" id="accruedSalariesInput" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="أدخل مبلغ الرواتب المستحقة">
            </div>
            <!-- End of Accrued Salaries Input Group -->


            <div class="space-y-4">
                <p class="block text-sm font-bold text-gray-700">مدة الخدمة</p>
                <div class="mt-4 space-y-4">
                    <div>
                        <label for="startDate" class="block text-sm font-medium text-gray-700">تاريخ بداية العمل</label>
                        <input type="date" id="startDate" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <div>
                        <label for="endDate" class="block text-sm font-medium text-gray-700">تاريخ نهاية العمل</label>
                        <input type="date" id="endDate" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <div id="contractEndDateInput" class="hidden bg-blue-50 p-3 rounded-md border border-blue-200">
                        <label for="contractEndDate" class="block text-sm font-medium text-blue-700">تاريخ نهاية العقد</label>
                        <input type="date" id="contractEndDate" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <!-- مدة الخدمة المحتسبة -->
                    <div id="serviceDurationDisplay" class="hidden bg-blue-50 p-3 rounded-md border border-blue-200">
                        <p class="text-sm font-medium text-blue-700">مدة الخدمة المحتسبة:</p>
                        <p class="text-base text-blue-900 font-bold mt-1" id="calculatedDuration"></p>
                    </div>
                    <!-- المدة المتبقية في العقد (جديد) -->
                    <div id="remainingContractDurationDisplay" class="hidden bg-red-50 p-3 rounded-md border border-red-200">
                        <p class="text-sm font-medium text-red-700">المدة المتبقية في العقد:</p>
                        <p class="text-base text-red-900 font-bold mt-1" id="calculatedRemainingDuration"></p>
                    </div>
                    <!-- New section for calculated leave days with an editable input field -->
                    <div id="calculatedLeaveDaysDisplay" class="hidden bg-blue-50 p-3 rounded-md border border-blue-200">
                        <label for="calculatedLeaveDays" class="text-sm font-medium text-blue-700">
                            عدد أيام الإجازات السنوية المحتسبة (بحد أقصى سنتين - يمكنك التعديل):
                        </label>
                        <input type="number" id="calculatedLeaveDays" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <div id="overtimeDaysPerYearDisplay" class="hidden bg-blue-50 p-3 rounded-md border border-blue-200">
                        <label for="overtimeDaysPerYear" class="text-sm font-medium text-blue-700">
                            عدد أيام العمل الإضافي خلال آخر سنتين (يمكنك التعديل):
                        </label>
                        <input type="number" id="overtimeDaysPerYear" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                </div>
            </div>

            <!-- Entitlement Options Box - ADDED bg-blue-50, p-4, rounded-lg, border border-blue-200 -->
            <div class="space-y-4 bg-blue-50 p-4 rounded-lg border border-blue-200">
                <p class="block text-sm font-bold text-gray-700">خيارات الاستحقاق والتعويض</p>
                
                <!-- Row 1: Social Security & Notice Compensation -->
                <div class="flex flex-col sm:flex-row sm:space-x-4 sm:space-x-reverse space-y-2 sm:space-y-0">
                    <div class="flex items-center sm:w-1/2">
                        <input type="checkbox" id="socialSecurity" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="socialSecurity" class="ml-2 block text-sm font-medium text-gray-700">مشترك في الضمان الاجتماعي</label>
                    </div>
                    <!-- Notice Compensation Entitlement -->
                    <div class="flex items-center sm:w-1/2">
                        <input type="checkbox" id="noticeCompensationEntitlement" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="noticeCompensationEntitlement" class="ml-2 block text-sm font-medium text-gray-700">يستحق بدل شهر الإشعار</label>
                    </div>
                </div>

                <!-- Row 2: Arbitrary Dismissal (Non-Fixed Term) & Arbitrary Dismissal (Fixed Term) -->
                <div class="flex flex-col sm:flex-row sm:space-x-4 sm:space-x-reverse space-y-2 sm:space-y-0">
                    <div class="flex items-center sm:w-1/2">
                        <input type="checkbox" id="arbitraryDismissal" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="arbitraryDismissal" class="ml-2 block text-sm font-medium text-gray-700">فصل تعسفي (عقد غير محدد المدة)</label>
                    </div>
                    <div class="flex items-center sm:w-1/2">
                        <input type="checkbox" id="fixedTerm" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="fixedTerm" class="ml-2 block text-sm font-medium text-gray-700">فصل تعسفي (عقد محدد المدة)</label>
                    </div>
                </div>
            </div>
            <!-- End Entitlement Options Box -->

            
            <!-- Overtime Input Group -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">العمل الإضافي</label>
                <div class="flex items-end space-x-2 space-x-reverse">
                    <div class="flex-grow">
                        <label for="overtimeHoursPerDay" class="block text-sm font-medium text-gray-700">ساعات العمل الإضافي في اليوم</label>
                        <input type="number" id="overtimeHoursPerDay" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="أدخل عدد الساعات">
                    </div>
                    <div class="flex-shrink-0 w-28">
                        <label for="overtimeRate" class="block text-sm font-medium text-gray-700">النسبة (%)</label>
                        <input type="number" id="overtimeRate" value="125" class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-center">
                    </div>
                </div>
            </div>

            <!-- Holiday and Friday Input Group (now separated) -->
            <label class="block text-sm font-bold text-gray-700 mb-1">العمل في العطل والأعياد وأيام الجمع</label>
            <div class="space-y-4">
                <!-- Holiday Input Group (Updated Label) -->
                <div class="flex items-end space-x-4 space-x-reverse">
                    <div class="flex-1">
                        <label for="holidayDays" class="block text-sm font-medium text-gray-700">أيام العطل الرسمية والدينية</label>
                        <input type="number" id="holidayDays" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="عدد الأيام">
                    </div>
                    <div class="flex-shrink-0 w-28">
                        <label for="holidayRate" class="block text-sm font-medium text-gray-700">النسبة (%)</label>
                        <input type="number" id="holidayRate" value="150" class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-center">
                    </div>
                </div>
                <!-- Friday Input Group -->
                <div class="flex items-end space-x-4 space-x-reverse">
                    <div class="flex-1">
                        <label for="fridayDays" class="block text-sm font-medium text-gray-700">أيام الجمع</label>
                        <input type="number" id="fridayDays" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="عدد الأيام">
                    </div>
                    <div class="flex-shrink-0 w-28">
                        <label for="fridayRate" class="block text-sm font-medium text-gray-700">النسبة (%)</label>
                        <input type="number" id="fridayRate" value="150" class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-center">
                    </div>
                </div>
            </div>

        </div>

        <!-- Action Buttons (Now side-by-side using flex) -->
        <div class="mt-8 flex gap-4">
            <button onclick="calculateRights()" class="w-1/2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                احسب المستحقات
            </button>
            <button onclick="resetFields()" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                تفريغ جميع الحقول
            </button>
        </div>


        <!-- Results Section -->
        <div id="results" class="mt-8 space-y-4">
            <h2 class="text-2xl font-bold text-blue-800 border-b pb-2 mb-4">النتائج</h2>

            <div id="serviceAward" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">مكافأة نهاية الخدمة:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="serviceAwardAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    * يتم احتساب المكافأة للعاملين الذين **ليسوا مشتركين في الضمان الاجتماعي** كما يلي:
                    <br>
                    * للعاملين براتب شهري: راتب شهر عن كل سنة خدمة كاملة، واحتساب كسور السنة على أساس تقسيم الراتب الشهري على 365 يوماً ثم ضربه بعدد أيام كسور السنة.
                    <br>
                    * للعاملين بأجر يومي: يُحتسب راتب شهر (30 يوماً) عن كل سنة خدمة كاملة، ويُحتسب بدل كسور السنة على أساس الأجر اليومي مضروباً بعدد أيام الخدمة الفعلية في كسر السنة.
                </p>
            </div>

            <div id="dismissalCompensation" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">بدل الفصل التعسفي:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="dismissalCompensationAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    * يتم احتساب التعويض كالآتي:
                    <br>
                    * **للعقد غير محدد المدة:** يُحتسب نصف راتب شهري عن كل سنة من سنوات الخدمة، بحد أدنى راتب شهرين.
                    <br>
                    * **للعقد محدد المدة:** يُحتسب بضرب الأجر اليومي في عدد الأيام المتبقية من العقد.
                </p>
            </div>

            <div id="noticeMonthCompensation" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">بدل شهر الإشعار:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="noticeMonthCompensationAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    *يُحتسب بدل الإشعار بمبلغ يعادل راتب شهر واحد، ويُقدر بـ الأجر اليومي مضروباً في 30 يوماً.
                </p>
            </div>
            
            <div id="leaveCompensation" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">بدل الإجازات السنوية:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="leaveCompensationAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    * يتم حسابها بضرب عدد أيام الإجازات المستحقة في الأجر اليومي، وبمجموع لا يتجاوز **آخر سنتين** من الخدمة.
                    <br>
                    * تطبق معادلة احتساب الإجازات بشكل نسبي (كسور السنة) باستخدام **365 يوماً**، والنتيجة النهائية لعدد الأيام يتم **تقريبها لأقرب عدد صحيح**.
                </p>
            </div>
            
            <div id="overtimeCompensationDiv" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">بدل ساعات العمل الإضافي:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="overtimeCompensationAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    *يُحتسب البدل عن مجموع الساعات الإضافية التي لم تُدفع لآخر سنتين، بضرب عدد الساعات الإضافية الإجمالي في أجر الساعة العادية، ثم ضربه بنسبة الزيادة المئوية المحددة (النسبة الافتراضية هي <span id="overtimeRateDisplay">125%</span>).
                </p>
            </div>

            <div id="holidayCompensationDiv" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">بدل دوام العطل والأعياد وأيام الجمع:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="holidayCompensationAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    * يُحتسب البدل عن الأيام التي لم تُدفع لآخر سنتين بضرب عدد الأيام في الأجر اليومي، ثم ضرب الناتج في النسبة المئوية المحددة (النسبة الافتراضية هي <span id="holidayRateDisplay">150%</span> للعطل و <span id="fridayRateDisplay">150%</span> لأيام الجمع). ويُدفع هذا البدل **بالإضافة إلى الأجر اليومي الأساسي**.
                </p>
            </div>

            <!-- Accrued Salaries Compensation -->
            <div id="accruedSalariesCompensationDiv" class="hidden">
                <h3 class="font-semibold text-lg text-gray-800">مبلغ الرواتب المستحقة غير المقبوضة:</h3>
                <p class="text-green-600 text-xl font-bold mt-1" id="accruedSalariesCompensationAmount"></p>
                <p class="text-sm text-gray-500 mt-1">
                    * هذا المبلغ يمثل الرواتب والأجور التي استحقت لك ولم يتم دفعها بعد (يُضاف كاملاً إلى الإجمالي).
                </p>
            </div>

            <!-- Total Amount Box (New Styling) -->
            <div id="total" class="hidden">
                <div id="total-box">
                    <h3 class="font-semibold text-lg mt-0">إجمالي المستحقات:</h3>
                    <p class="font-bold mt-1" id="totalAmount"></p>
                </div>
            </div>
            
            <div id="calculation-notes" class="hidden mt-6 text-sm text-gray-600 border-t pt-4">
                <h4 class="font-semibold mb-2">ملاحظات على الحساب:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li id="daily-wage-note" class="hidden">لاحتساب بدلات الفصل التعسفي وشهر الإنذار للعاملين بأجر يومي، تم تقدير الراتب الشهري على أساس الأجر اليومي مضروباً في 30 يوماً.</li>
                    <li id="daily-award-note" class="hidden">تم احتساب مكافأة نهاية الخدمة لعمال المياومة بضرب الأجر اليومي في 30 لكل سنة خدمة كاملة، بالإضافة إلى أجر كسور السنة المحسوبة على أساس **الأيام الفعلية** في كسر السنة.</li>
                </ul>
            </div>
            
            <div id="error-message" class="hidden bg-red-100 text-red-700 p-4 rounded-md mt-4">
                <p>الرجاء إدخال راتب شهري أو يومي ومدة خدمة صالحة.</p>
            </div>
            <div id="message-box" class="hidden bg-blue-100 text-blue-700 p-4 rounded-md mt-4"></div>
        </div>

        <!-- Contact and Copyright Info (Updated to be centered at the very bottom) -->
        <div class="mt-10 pt-4 border-t border-gray-200 footer-info">
            <p class="text-gray-700 font-semibold mb-1">المحامي معاذ ابو دوله هاتف 0788898842</p>
            <p class="text-xs text-gray-500">جميع الحقوق محفوظة</p>
        </div>
    </div>

    <script>
        const MS_IN_DAY = 1000 * 60 * 60 * 24;
        const DAYS_IN_YEAR_LEAVE = 365;

        document.addEventListener('DOMContentLoaded', () => {
            const salaryTypeRadios = document.getElementsByName('salaryType');
            const salaryLabel = document.getElementById('salaryLabel');
            const salaryInput = document.getElementById('salaryInput');
            const fixedTermCheckbox = document.getElementById('fixedTerm');
            const arbitraryDismissalCheckbox = document.getElementById('arbitraryDismissal');
            const contractEndDateInputDiv = document.getElementById('contractEndDateInput');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');

            salaryTypeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'monthly') {
                        salaryLabel.innerText = 'الراتب الشهري الأخير (دينار)';
                        salaryInput.placeholder = 'أدخل راتبك الشهري';
                    } else {
                        salaryLabel.innerText = 'الأجر اليومي الأخير (دينار)';
                        salaryInput.placeholder = 'أدخل أجرك اليومي';
                    }
                    
                    updateDurationAndLeaveAndOvertimeDisplay(); 
                });
            });

            fixedTermCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    contractEndDateInputDiv.classList.remove('hidden');
                    arbitraryDismissalCheckbox.checked = false;
                } else {
                    contractEndDateInputDiv.classList.add('hidden');
                }
                updateDurationAndLeaveAndOvertimeDisplay(); // تحديث العرض عند تغيير حالة المربع
            });

            arbitraryDismissalCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    fixedTermCheckbox.checked = false;
                    contractEndDateInputDiv.classList.add('hidden');
                }
                updateDurationAndLeaveAndOvertimeDisplay(); // تحديث العرض عند تغيير حالة المربع
            });

            // 1. المستمع لتاريخ البداية (لتحديث المدة فقط)
            startDateInput.addEventListener('change', updateDurationAndLeaveAndOvertimeDisplay);
            
            // 2. المستمع لتاريخ النهاية (للتأكد من صحة التواريخ عند المغادرة)
            // الآن الحد الأحمر يظهر فقط عند 'blur'
            endDateInput.addEventListener('blur', checkDateValidityAndDisplay);
            // change يبقى لتحديث المدة والعروض الأخرى فورًا عند اختيار التاريخ
            endDateInput.addEventListener('change', updateDurationAndLeaveAndOvertimeDisplay); 
            
            // المستمع لتاريخ نهاية العقد (لتحديث المدة المتبقية)
            document.getElementById('contractEndDate').addEventListener('change', updateDurationAndLeaveAndOvertimeDisplay);
            
            // Update rate display in the results description when input changes
            document.getElementById('overtimeRate').addEventListener('input', () => {
                document.getElementById('overtimeRateDisplay').innerText = document.getElementById('overtimeRate').value + '%';
            });
            document.getElementById('holidayRate').addEventListener('input', () => {
                document.getElementById('holidayRateDisplay').innerText = document.getElementById('holidayRate').value + '%';
            });
            document.getElementById('fridayRate').addEventListener('input', () => {
                document.getElementById('fridayRateDisplay').innerText = document.getElementById('fridayRate').value + '%';
            });
        });
        
        /**
         * دالة للتحقق من صحة التواريخ وتطبيق/إزالة الحد الأحمر
         * تُستدعى حصرياً عند مغادرة حقل endDate (حدث blur).
         */
        function checkDateValidityAndDisplay() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const startDateStr = startDateInput.value;
            const endDateStr = endDateInput.value;

            // إزالة حدود الخطأ السابقة
            startDateInput.classList.remove('date-error-border');
            endDateInput.classList.remove('date-error-border');

            if (startDateStr && endDateStr) {
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);

                // التحقق من صحة التواريخ (تاريخ النهاية يجب أن يكون بعد تاريخ البداية)
                if (startDate > endDate) {
                    startDateInput.classList.add('date-error-border');
                    endDateInput.classList.add('date-error-border');
                }
            }
        }

        /**
         * دالة لتفريغ جميع حقول الإدخال والنتائج وإعادة تعيين الحالات الافتراضية
         */
        function resetFields() {
            // 1. Inputs and Dates
            document.getElementById('salaryInput').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('contractEndDate').value = '';
            document.getElementById('overtimeHoursPerDay').value = '';
            document.getElementById('holidayDays').value = '';
            document.getElementById('fridayDays').value = '';
            document.getElementById('accruedSalariesInput').value = ''; 
            
            // 2. Checkboxes and Radios (set to default state: monthly checked, others unchecked)
            document.getElementById('monthly').checked = true;
            document.getElementById('daily').checked = false;
            document.getElementById('socialSecurity').checked = false;
            document.getElementById('arbitraryDismissal').checked = false;
            document.getElementById('fixedTerm').checked = false;
            document.getElementById('noticeCompensationEntitlement').checked = false;
            
            // Reset rate defaults (if changed by user)
            document.getElementById('overtimeRate').value = '125';
            document.getElementById('holidayRate').value = '150';
            document.getElementById('fridayRate').value = '150';
            
            // 3. Calculated Inputs and Display areas (hide and clear content)
            document.getElementById('contractEndDateInput').classList.add('hidden');
            document.getElementById('serviceDurationDisplay').classList.add('hidden');
            document.getElementById('remainingContractDurationDisplay').classList.add('hidden'); 
            document.getElementById('calculatedLeaveDaysDisplay').classList.add('hidden');
            document.getElementById('overtimeDaysPerYearDisplay').classList.add('hidden');
            
            document.getElementById('calculatedDuration').innerText = '';
            document.getElementById('calculatedRemainingDuration').innerText = ''; 
            document.getElementById('calculatedLeaveDays').value = '';
            document.getElementById('overtimeDaysPerYear').value = '';

            // 4. Results Section (hide all and clear text)
            const resultsDivs = [
                'serviceAward', 'dismissalCompensation', 'noticeMonthCompensation', 
                'leaveCompensation', 'overtimeCompensationDiv', 'holidayCompensationDiv', 
                'accruedSalariesCompensationDiv', 
                'total', 'calculation-notes', 'error-message', 'message-box'
            ];
            
            resultsDivs.forEach(id => document.getElementById(id).classList.add('hidden'));

            document.getElementById('serviceAwardAmount').innerText = '';
            document.getElementById('dismissalCompensationAmount').innerText = '';
            document.getElementById('noticeMonthCompensationAmount').innerText = '';
            document.getElementById('leaveCompensationAmount').innerText = '';
            document.getElementById('overtimeCompensationAmount').innerText = '';
            document.getElementById('holidayCompensationAmount').innerText = '';
            document.getElementById('accruedSalariesCompensationAmount').innerText = ''; 
            document.getElementById('totalAmount').innerText = '';

            // Reset salary label to default monthly
            document.getElementById('salaryLabel').innerText = 'الراتب الشهري الأخير (دينار)';
            document.getElementById('salaryInput').placeholder = 'أدخل راتبك الشهري';
            
            // Remove date error class
            document.getElementById('startDate').classList.remove('date-error-border');
            document.getElementById('endDate').classList.remove('date-error-border');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateDurationAndLeaveAndOvertimeDisplay() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const startDateStr = startDateInput.value;
            const endDateStr = endDateInput.value;
            const contractEndDateStr = document.getElementById('contractEndDate').value;
            const fixedTermCheckbox = document.getElementById('fixedTerm');

            const serviceDurationDisplay = document.getElementById('serviceDurationDisplay');
            const calculatedDuration = document.getElementById('calculatedDuration');
            const calculatedLeaveDaysDisplay = document.getElementById('calculatedLeaveDaysDisplay');
            const calculatedLeaveDaysInput = document.getElementById('calculatedLeaveDays');
            const overtimeDaysPerYearDisplay = document.getElementById('overtimeDaysPerYearDisplay');
            const overtimeDaysPerYearInput = document.getElementById('overtimeDaysPerYear');
            
            const remainingContractDurationDisplay = document.getElementById('remainingContractDurationDisplay');
            const calculatedRemainingDuration = document.getElementById('calculatedRemainingDuration');

            remainingContractDurationDisplay.classList.add('hidden');
            calculatedRemainingDuration.innerText = '';

            if (startDateStr && endDateStr) {
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);

                // --- التحقق من صحة التواريخ (تاريخ النهاية يجب أن يكون بعد تاريخ البداية) ---
                if (startDate > endDate) {
                    
                    // إخفاء نتائج المدة المحتسبة عند وجود خطأ
                    serviceDurationDisplay.classList.add('hidden');
                    calculatedLeaveDaysDisplay.classList.add('hidden');
                    overtimeDaysPerYearDisplay.classList.add('hidden');
                    remainingContractDurationDisplay.classList.add('hidden'); 
                    return; // التوقف عن الحساب إذا كانت التواريخ غير صالحة
                }
                // --- نهاية التحقق من صحة التواريخ ---
                
                const duration = calculateDuration(startDateStr, endDateStr);
                
                if (duration.years >= 0 && duration.months >= 0 && duration.days >= 0 && (duration.years > 0 || duration.months > 0 || duration.days > 0)) {
                    serviceDurationDisplay.classList.remove('hidden');
                    calculatedDuration.innerText = `${duration.years} سنة و ${duration.months} شهر و ${duration.days} يوم`;
                    
                    // --- منطق احتساب المدة المتبقية في العقد (جديد) ---
                    if (fixedTermCheckbox.checked && contractEndDateStr) {
                        const employmentEndDate = new Date(endDateStr);
                        const contractEndDate = new Date(contractEndDateStr);
                        
                        // يجب أن يكون تاريخ نهاية العقد بعد تاريخ نهاية الخدمة للاستحقاق
                        if (contractEndDate > employmentEndDate) {
                            // نستخدم endDateStr و contractEndDateStr لحساب الفرق بالسنوات والأشهر والأيام
                            const remainingDuration = calculateDuration(endDateStr, contractEndDateStr);
                            
                            remainingContractDurationDisplay.classList.remove('hidden');
                            calculatedRemainingDuration.innerText = 
                                `${remainingDuration.years} سنة و ${remainingDuration.months} شهر و ${remainingDuration.days} يوم`;
                        } else {
                            // إخفاء إذا لم يكن هناك مدة متبقية
                            remainingContractDurationDisplay.classList.add('hidden');
                        }
                    }

                    // --- منطق احتساب الإجازات المحدث (حسب مدة الخدمة ومجموع سنتين كحد أقصى) ---
                    const T_start_date = new Date(startDateStr);
                    const T_end_date = new Date(endDateStr);
                    const D_service = (T_end_date - T_start_date) / MS_IN_DAY; // مجموع أيام الخدمة الفعلية

                    // 1. نقطة التحول: تاريخ إكمال 4 سنوات (بداية السنة الخامسة)
                    const T_4y_date = new Date(T_start_date);
                    T_4y_date.setFullYear(T_start_date.getFullYear() + 4);

                    // 2. تاريخ بداية فترة التعويض (سنتان قبل تاريخ النهاية)
                    const T_2y_date = new Date(T_end_date);
                    T_2y_date.setFullYear(T_end_date.getFullYear() - 2);

                    // 3. التاريخ الفعلي لبدء فترة التعويض (الأبعد بين تاريخ البدء الفعلي وتاريخ سنتين للوراء)
                    const T_comp_start_time = Math.max(T_start_date.getTime(), T_2y_date.getTime());
                    
                    let daysAt14Rate = 0; // الأيام التي تستحق 14 يومًا في آخر سنتين (قبل إكمال 4 سنوات)
                    let daysAt21Rate = 0; // الأيام التي تستحق 21 يومًا في آخر سنتين (منذ إكمال 4 سنوات فصاعداً)

                    // الفترة المستحقة لـ 14 يومًا تنتهي عند T_4y_date
                    const T_14_end_time = Math.min(T_end_date.getTime(), T_4y_date.getTime());

                    if (T_comp_start_time < T_14_end_time) {
                        // حساب الأيام المستحقة لـ 14 يومًا: من بدء التعويض حتى 4 سنوات (أو نهاية الخدمة، أيهما أقرب)
                        daysAt14Rate = (T_14_end_time - T_comp_start_time) / MS_IN_DAY;
                    }

                    // الفترة المستحقة لـ 21 يومًا تبدأ من T_4y_date
                    const T_21_start_time = Math.max(T_comp_start_time, T_4y_date.getTime());

                    if (T_21_start_time < T_end_date.getTime()) {
                        // حساب الأيام المستحقة لـ 21 يومًا: من 4 سنوات (أو بدء التعويض، أيهما أبعد) حتى نهاية الخدمة
                        daysAt21Rate = (T_end_date.getTime() - T_21_start_time) / MS_IN_DAY;
                    }

                    let totalDeservedLeaveDays = 0;

                    if (D_service > 0) {
                        // استخدام 365 يوماً في السنة (حسب الطلب)
                        const LEAVE_DAYS_PER_YEAR = 365; 
                        
                        const leaveFrom14 = daysAt14Rate * (14 / LEAVE_DAYS_PER_YEAR);
                        const leaveFrom21 = daysAt21Rate * (21 / LEAVE_DAYS_PER_YEAR);
                        
                        totalDeservedLeaveDays = leaveFrom14 + leaveFrom21;
                    }
                    
                    // تطبيق التقريب لأقرب عدد صحيح (حسب الطلب)
                    const roundedLeaveDays = Math.round(totalDeservedLeaveDays);
                    
                    // --- نهاية منطق احتساب الإجازات المحدث ---

                    if (roundedLeaveDays > 0) {
                        calculatedLeaveDaysDisplay.classList.remove('hidden');
                        calculatedLeaveDaysInput.value = roundedLeaveDays;
                    } else {
                        calculatedLeaveDaysDisplay.classList.add('hidden');
                        calculatedLeaveDaysInput.value = '';
                    }

                    // حساب عدد الأيام الإجمالي في مدة الخدمة بحد أقصى سنتين لغرض تقدير العمل الإضافي
                    const maxOvertimeDays = 2 * 365;
                    const overtimeDaysInTwoYears = Math.min(maxOvertimeDays, D_service);
                    
                    // نقوم بعرض عدد الأيام التي يستحق عنها العامل البدل بحد أقصى سنتين
                    if (overtimeDaysInTwoYears > 0) {
                        overtimeDaysPerYearDisplay.classList.remove('hidden');
                        overtimeDaysPerYearInput.value = overtimeDaysInTwoYears.toFixed(0);
                    } else {
                        overtimeDaysPerYearDisplay.classList.add('hidden');
                        overtimeDaysPerYearInput.value = '';
                    }

                } else {
                    serviceDurationDisplay.classList.add('hidden');
                    calculatedLeaveDaysDisplay.classList.add('hidden');
                    overtimeDaysPerYearDisplay.classList.add('hidden');
                }
            } else {
                serviceDurationDisplay.classList.add('hidden');
                calculatedLeaveDaysDisplay.classList.add('hidden');
                overtimeDaysPerYearDisplay.classList.add('hidden');
                remainingContractDurationDisplay.classList.add('hidden'); // إخفاء عند عدم إدخال التواريخ
            }
        }

        function showResults() {
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * تحسب فرق التاريخ بالسنوات والأشهر والأيام بدقة (حسب التقويم الميلادي).
         * @param {string} startDateStr - تاريخ البداية (YYYY-MM-DD).
         * @param {string} endDateStr - تاريخ النهاية (YYYY-MM-DD).
         * @returns {object} - يحتوي على سنوات وأشهر وأيام الخدمة.
         */
        function calculateDuration(startDateStr, endDateStr) {
            const startDate = new Date(startDateStr);
            const endDate = new Date(endDateStr);

            if (startDate > endDate) {
                return { years: -1, months: -1, days: -1 };
            }

            let years = endDate.getFullYear() - startDate.getFullYear();
            let months = endDate.getMonth() - startDate.getMonth();
            let days = endDate.getDate() - startDate.getDate();

            if (days < 0) {
                // اقتراض يوم من الشهر السابق
                months--;
                // تحديد عدد أيام الشهر السابق الفعلي (صفر لليوم يعطي آخر يوم في الشهر السابق)
                const prevMonth = new Date(endDate.getFullYear(), endDate.getMonth(), 0);
                days += prevMonth.getDate(); 
            }

            if (months < 0) {
                // اقتراض شهر من السنة السابقة
                years--;
                months += 12;
            }

            return { years, months, days };
        }

        /**
         * دالة لعرض رسالة في صندوق رسائل مخصص في الأسفل
         * @param {string} message - محتوى الرسالة
         */
        function showMessageBox(message, isError = false) {
            const messageBox = document.getElementById('message-box');
            const errorMessage = document.getElementById('error-message');
            
            // إخفاء كلاهما أولاً
            messageBox.classList.add('hidden');
            errorMessage.classList.add('hidden');

            if (isError) {
                errorMessage.innerText = message;
                errorMessage.classList.remove('hidden');
                messageBox.classList.add('hidden');
            } else {
                // لا تعرض رسالة النجاح حسب طلب المستخدم السابق
                errorMessage.classList.add('hidden');
            }
            showResults();
        }

        function calculateRights() {
            const startDateStr = document.getElementById('startDate').value;
            const endDateStr = document.getElementById('endDate').value;
            const contractEndDateStr = document.getElementById('contractEndDate').value; // جلب تاريخ نهاية العقد
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            // 1. إجراء التحقق من الصحة وتطبيق الحدود فور الضغط على زر الحساب
            checkDateValidityAndDisplay();

            // إخفاء رسائل الخطأ والتنبيه السابقة
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('message-box').classList.add('hidden');
            

            if (!startDateStr || !endDateStr) {
                showMessageBox('الرجاء إدخال تاريخ بداية العمل وتاريخ نهاية العمل.', true);
                return;
            }

            const duration = calculateDuration(startDateStr, endDateStr);
            
            // 2. التحقق من وجود حدود خطأ مطبقة، وفي هذه الحالة نوقف الحساب
            if (startDateInput.classList.contains('date-error-border') || endDateInput.classList.contains('date-error-border')) {
                 showMessageBox('تاريخ نهاية الخدمة يجب أن يكون بعد تاريخ بداية الخدمة.', true);
                return;
            }

            const totalServiceDays = (new Date(endDateStr) - new Date(startDateStr)) / (1000 * 60 * 60 * 24);
            const serviceYearsForDismissal = totalServiceDays / 365; // يستخدم 365 لتطبيق معادلة الفصل التعسفي

            const salaryInput = parseFloat(document.getElementById('salaryInput').value);
            const isMonthlySalary = document.getElementById('monthly').checked;
            const isSocialSecurity = document.getElementById('socialSecurity').checked;
            const isArbitraryDismissal = document.getElementById('arbitraryDismissal').checked;
            const isFixedTermDismissal = document.getElementById('fixedTerm').checked;
            const isNoticeCompensationEntitlement = document.getElementById('noticeCompensationEntitlement').checked;

            const leaveDaysInput = parseFloat(document.getElementById('calculatedLeaveDays').value);
            const overtimeHoursPerDayInput = parseFloat(document.getElementById('overtimeHoursPerDay').value) || 0;
            const overtimeRateInput = parseFloat(document.getElementById('overtimeRate').value) / 100 || 1.25;
            const holidayDaysInput = parseFloat(document.getElementById('holidayDays').value) || 0;
            const holidayRateInput = parseFloat(document.getElementById('holidayRate').value) / 100 || 1.50;
            const fridayDaysInput = parseFloat(document.getElementById('fridayDays').value) || 0;
            const fridayRateInput = parseFloat(document.getElementById('fridayRate').value) / 100 || 1.50;
            const overtimeDaysPerYear = parseFloat(document.getElementById('overtimeDaysPerYear').value) || 0;
            const accruedSalariesInput = parseFloat(document.getElementById('accruedSalariesInput').value) || 0; // Get accrued salaries input

            if (isNaN(salaryInput) || salaryInput <= 0) {
                showMessageBox('الرجاء إدخال راتب أو أجر يومي صالح.', true);
                return;
            }

            // --- تحديد الأجر اليومي والشهري الأساسي ---
            let monthlySalary = 0;
            let dailyWage = 0;
            
            if (isMonthlySalary) {
                monthlySalary = salaryInput;
                dailyWage = monthlySalary / 30; // 30 يومًا افتراضياً لحساب الأجر اليومي من الراتب الشهري
            } else {
                dailyWage = salaryInput;
                monthlySalary = dailyWage * 30; // 30 يومًا لحساب الراتب الشهري من الأجر اليومي
            }

            // --- المتغيرات النهائية للمبالغ ---
            let totalAmount = 0;
            let serviceAward = 0;
            let dismissalCompensation = 0;
            let noticeMonthCompensation = 0;
            let leaveCompensation = 0;
            let overtimeCompensation = 0;
            let holidayCompensation = 0;
            let accruedSalariesCompensation = 0; // Accrued salaries compensation

            // إخفاء جميع الحسابات أولاً
            document.getElementById('serviceAward').classList.add('hidden');
            document.getElementById('dismissalCompensation').classList.add('hidden');
            document.getElementById('noticeMonthCompensation').classList.add('hidden');
            document.getElementById('leaveCompensation').classList.add('hidden');
            document.getElementById('overtimeCompensationDiv').classList.add('hidden');
            document.getElementById('holidayCompensationDiv').classList.add('hidden');
            document.getElementById('accruedSalariesCompensationDiv').classList.add('hidden'); 
            document.getElementById('total').classList.add('hidden');
            document.getElementById('calculation-notes').classList.add('hidden');
            document.getElementById('daily-wage-note').classList.add('hidden');
            document.getElementById('daily-award-note').classList.add('hidden');
            
            // --- 1. مكافأة نهاية الخدمة ---
            if (!isSocialSecurity) {
                // يُحتسب راتب شهر (30 يومًا) عن كل سنة خدمة كاملة، واحتساب كسور السنة على أساس أيام الخدمة الفعلية في كسر السنة.
                const fullYears = duration.years;
                const daysInPartialYear = totalServiceDays - (fullYears * 365); // حساب الأيام الفعلية في كسر السنة

                if (isMonthlySalary) {
                    // راتب شهر عن كل سنة + كسور السنة (راتب شهري / 365) * عدد الأيام
                    serviceAward = (fullYears * monthlySalary) + (monthlySalary / 365 * daysInPartialYear);
                } else {
                    // راتب شهر (30 يومًا) عن كل سنة + كسور السنة (الأجر اليومي * عدد الأيام)
                    serviceAward = (fullYears * monthlySalary) + (dailyWage * daysInPartialYear);
                    document.getElementById('daily-award-note').classList.remove('hidden');
                }
                
                totalAmount += serviceAward;
                document.getElementById('serviceAwardAmount').innerText = serviceAward.toFixed(2) + ' دينار';
                document.getElementById('serviceAward').classList.remove('hidden');
            }


            // --- 2. بدل الفصل التعسفي ---
            if (isArbitraryDismissal) {
                // عقد غير محدد المدة: نصف راتب شهري عن كل سنة خدمة، بحد أدنى شهرين.
                const monthsCompensation = Math.max(2, serviceYearsForDismissal * 0.5);
                dismissalCompensation = monthlySalary * monthsCompensation;
                
                totalAmount += dismissalCompensation;
                document.getElementById('dismissalCompensationAmount').innerText = dismissalCompensation.toFixed(2) + ' دينار';
                document.getElementById('dismissalCompensation').classList.remove('hidden');
                
                if (!isMonthlySalary) {
                    document.getElementById('daily-wage-note').classList.remove('hidden');
                }
            } else if (isFixedTermDismissal && contractEndDateStr) {
                const employmentEndDate = new Date(endDateStr);
                const contractEndDate = new Date(contractEndDateStr);
                
                if (contractEndDate > employmentEndDate) {
                    const remainingDays = (contractEndDate - employmentEndDate) / MS_IN_DAY;
                    
                    if (remainingDays > 0) {
                        // يتم احتساب التعويض على أساس الأجر اليومي مضروباً في عدد الأيام المتبقية
                        dismissalCompensation = dailyWage * remainingDays;
                        
                        totalAmount += dismissalCompensation;
                        document.getElementById('dismissalCompensationAmount').innerText = dismissalCompensation.toFixed(2) + ' دينار';
                        document.getElementById('dismissalCompensation').classList.remove('hidden');
                        
                        if (!isMonthlySalary) {
                             document.getElementById('daily-wage-note').classList.remove('hidden'); // ملاحظة التقدير مطلوبة
                        }
                    }
                }
            }


            // --- 3. بدل شهر الإشعار (الإنذار) ---
            if (isNoticeCompensationEntitlement) {
                // يساوي راتب شهر واحد (30 يومًا).
                noticeMonthCompensation = monthlySalary;
                
                totalAmount += noticeMonthCompensation;
                document.getElementById('noticeMonthCompensationAmount').innerText = noticeMonthCompensation.toFixed(2) + ' دينار';
                document.getElementById('noticeMonthCompensation').classList.remove('hidden');

                if (!isMonthlySalary) {
                    document.getElementById('daily-wage-note').classList.remove('hidden');
                }
            }

            // --- 4. بدل الإجازات السنوية ---
            if (!isNaN(leaveDaysInput) && leaveDaysInput > 0) {
                // بدل الإجازات السنوية = الأجر اليومي * عدد الأيام
                leaveCompensation = dailyWage * leaveDaysInput;
                
                totalAmount += leaveCompensation;
                document.getElementById('leaveCompensationAmount').innerText = leaveCompensation.toFixed(2) + ' دينار';
                document.getElementById('leaveCompensation').classList.remove('hidden');
            }

            // --- 5. بدل العمل الإضافي (Overtime) ---
            if (overtimeHoursPerDayInput > 0 && overtimeDaysPerYear > 0) {
                // الأجر بالساعة = الأجر اليومي / 8 (ساعات العمل العادية)
                const hourlyWage = dailyWage / 8;
                
                // إجمالي ساعات العمل الإضافية في آخر سنتين (أو مدة الخدمة الفعلية)
                const totalOvertimeHours = overtimeHoursPerDayInput * overtimeDaysPerYear;
                
                // البدل = إجمالي الساعات * أجر الساعة * (نسبة الزيادة - 1)
                // في الأردن، الزيادة هي 25% (لتصبح 125% من الأجر الأساسي)، أي يتم دفع 25% إضافية
                const increaseRate = overtimeRateInput - 1;

                // يتم احتساب البدل على أساس ما لم يُدفع، وهو معدل الزيادة فقط
                overtimeCompensation = totalOvertimeHours * hourlyWage * increaseRate;
                
                totalAmount += overtimeCompensation;
                document.getElementById('overtimeCompensationAmount').innerText = overtimeCompensation.toFixed(2) + ' دينار';
                document.getElementById('overtimeCompensationDiv').classList.remove('hidden');
            }
            
            // --- 6. بدل دوام العطل والأعياد وأيام الجمع ---
            let totalHolidayDays = (holidayDaysInput * holidayRateInput) + (fridayDaysInput * fridayRateInput);
            
            if (holidayDaysInput > 0 || fridayDaysInput > 0) {
                // البدل يساوي الأجر اليومي مضروباً في نسبة الزيادة المحددة
                // بما أن البدل يُدفع بالإضافة إلى الأجر الأساسي، فالبدل الإضافي هو (النسبة - 1) من الأجر
                
                // بدل العطل والأعياد: عدد الأيام * الأجر اليومي * (نسبة الزيادة - 1)
                const holidayCompensationValue = holidayDaysInput * dailyWage * (holidayRateInput - 1);
                
                // بدل أيام الجمع: عدد الأيام * الأجر اليومي * (نسبة الزيادة - 1)
                const fridayCompensationValue = fridayDaysInput * dailyWage * (fridayRateInput - 1);

                holidayCompensation = holidayCompensationValue + fridayCompensationValue;
                
                totalAmount += holidayCompensation;
                document.getElementById('holidayCompensationAmount').innerText = holidayCompensation.toFixed(2) + ' دينار';
                document.getElementById('holidayCompensationDiv').classList.remove('hidden');
            }
            
            // --- 7. الرواتب المستحقة (الرواتب غير مقبوضة) ---
            if (accruedSalariesInput > 0) {
                accruedSalariesCompensation = accruedSalariesInput;
                totalAmount += accruedSalariesCompensation;
                document.getElementById('accruedSalariesCompensationAmount').innerText = accruedSalariesCompensation.toFixed(2) + ' دينار';
                document.getElementById('accruedSalariesCompensationDiv').classList.remove('hidden');
            }


            // --- المجموع الكلي ---
            if (totalAmount > 0) {
                document.getElementById('totalAmount').innerText = totalAmount.toFixed(2) + ' دينار';
                document.getElementById('total').classList.remove('hidden');
                document.getElementById('calculation-notes').classList.remove('hidden');

                // لا تعرض رسالة نجاح، فقط انتقل للنتائج
                showResults();
            } else {
                showMessageBox('لا توجد مستحقات في هذا السيناريو أو أن المدخلات غير كافية.', true);
            }
        }
    </script>
</body>
</html>
